---
title: 第二章 总线
category: 计算机组成原理
order: 2
excerpt: 计组第二章-总线
---

## 总线的基本概念

<img src="/imgs/image-20230315093656648.png" alt="image-20230315093656648" style="zoom:50%;" />

## 总线的分类

### 片内总线

==芯片内部==的总线

### 系统总线

计算机各部件之间的信息传输线

- 数据总线	==双向==	与机器字长、存储字长有关
- 地址总线    ==单向==    与存储地址、I/O地址有关
- 控制总线    ==有出  有入==     

### 通信总线

用于计算机系统之间的通信

## 总线特性及性能指标

### 总线物理实现

![image-20230315094929657](/imgs/image-20230315094929657.png)

### 总线特性

- 机械特性   尺寸、形状、管脚数及排列顺序
- 电气特性   传输方向和有效的电平范围
- 功能特性   每根传输线的功能  地址  数据 控制
- 时间特性   信号的时序关系

### 总线的性能指标

1. 总线宽度  数据线的根数
2. 标准传输率  每秒传输的最大字节率(MBps)
3. 时钟同步/异步  同步 不同步
4. 总线复用   地址线与数据线复用
5. 信号线数   地址线、数据线和控制线的总和
6. 总线控制方式
7. 其他    负载能力

## 总线标准

![image-20230315095604305](/imgs/image-20230315095604305.png)

## 总线结构

### 单总线结构

![image-20230315095925367](/imgs/image-20230315095925367.png)

- 当主存有数据朝外输出 当io有数据朝主存传  cpu无法进行计算
- 当cpu传数据给远端io 有数据延迟

### 多总线结构

#### 双总线结构

![image-20230315100004598](/imgs/image-20230315100004598.png)

> ​	由于io想要传输数据给主存要经过两根总线 对于高速外设很不友好于是出现了三总线 专门给高速外设一根总线连接主存

#### 三总线结构

![image-20230315100059807](/imgs/image-20230315100059807.png)

#### 三总线结构的又一形式

![image-20230315100244186](/imgs/image-20230315100244186.png)

> 拓展总线的外设速度不一致 会导致高速外设性能下降

#### 四总线结构

![image-20230315100324941](/imgs/image-20230315100324941.png)

### 总线结构举例

#### 传统微型机总线结构

![image-20230315100838744](/imgs/image-20230315100838744.png)

#### VL-BUS局部总线结构

![image-20230315100915627](/imgs/image-20230315100915627.png)

#### PCI总线

![image-20230315100937658](/imgs/image-20230315100937658.png)

#### 多层PCI总线结构

![image-20230315101023338](/imgs/image-20230315101023338.png)

## 总线控制

### 总线判优控制

#### 基本概念

- 主设备    对总线有控制权
- 从设备  响应从主设备发来的总线命令
- 总线判优控制
  - 集中式
    - 链式查询
    - 计数器定时查询
    - 独立请求方式
  - 分布式
- 解决哪个设备使用总线

#### 链式查询方式



![image-20230315101448265](/imgs/image-20230315101448265.png)

> 当IO接口3想要使用总线  首先通过BR线向总线控制部件发请求  总线控制设备通过BG线寻找谁发的请求 先通过IO接口1 在经过IO接口2 最后到IO接口3 接到BG信号后 IO接口3向BS线发信号 表示总线正在使用  之后IO接口3获得总线使用权

缺点

- 由于链式查询 若前面的IO接口和后面的IO接口同时法请求  后面的接口优先级低 越靠后优先级越低  越难获得使用权
- 链式查询如果某个接口故障 后面的接口无法获得BG信号

优点

- 结构简单
- 可拓展性强

#### 计数器定时查询

![image-20230315102906522](/imgs/image-20230315102906522.png)

> 计数器设为0  当IO接口1想要使用总线  通过BR线发送请求 总线控制设备接收请求后通过计数器的值用设备地址询问 因为计数器为0向接口0询问是否发送请求 之后计数器加1 向接口1询问 接口1发送BS信号 获得总线使用权

- 通过编程方式改变计数器的值 可以控制io接口的优先级
- 需要一个一个查询 比较慢

#### 独立请求方式

![image-20230315104437511](/imgs/image-20230315104437511.png)

> 通过排队器来确定优先级

### 总线通信控制

前置	主设备通过总线判优控制获得总线的使用权

目的    解决通信双方协调配合问题

#### 总线传输周期

- 申请分配阶段    主模块申请，总线仲裁决定(总线判优控制实现)
- 寻址阶段    主模块向从模块给出地址和命令
- 传数阶段    主模块和从模块交换数据
- 结束阶段    主模块撤销有关信息

#### 总线通信的四种方式

- 同步通信  由统一时标控制数据传送
- 异步通信  采用应答方式
- 半同步通信  解决不同速度的设备通信(同步异步结合)
- 分离式通信  充分挖掘系统总线每个瞬间的潜力

#### 同步通信

**数据写入(读从设备数据)**

![image-20230315111204156](/imgs/image-20230315111204156.png)

> 在第一个传输周期上升沿  主设备给出从设备地址并持续
>
> 在第二个总线传输周期上升沿 给出读命令
>
> 在第三个传输周期上升沿从设备需要将需要数据发送到数据线上
>
> 在第三个传输周期下降沿结束读命令和数据 
>
> 在第四个传输周期下降沿取消地址的传送

**数据输出(写入从设备数据)**

![image-20230315111708990](/imgs/image-20230315111708990.png)

#### 异步通信

![image-20230315112327905](/imgs/image-20230315112327905.png)

> 不互锁:主设备给出请求信号 从设备给出应答信号 主设备不管有没有接收到应答信号在一段时间都结束请求  从设备不管主设备有没有接收到应答信号在一段时间都会结束应答
>
> 半互锁:只有主设备接收到应答信号才结束请求  问题是如果从设备一段时间后结束应答 主设备一直没收到应答就会一直处于请求状态
>
> 全互锁:只有主设备收到应答才结束请求 只有主设备结束请求从设备才结束应答

#### 半同步通信(同步、异步结合)

![image-20230315112935895](/imgs/image-20230315112935895.png)

**以输入数据为例的半同步通信时序**

![image-20230315122216107](/imgs/image-20230315122216107.png)

![image-20230315122304926](/imgs/image-20230315122304926.png)

> 从设备接收到命令后将wait置为低电平 然后准备数据 主模块每过一个时钟周期会检测一次wait  直到wait为高电平  从模块在准备好数据后将Tw置为高 然后传输数据 到T3周期

#### 共同点

![image-20230315122937413](/imgs/image-20230315122937413.png)

#### 分离式通信

![image-20230315123040189](/imgs/image-20230315123040189.png)

![image-20230315123416163](/imgs/image-20230315123416163.png)